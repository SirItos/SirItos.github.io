(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[46],{e0d3:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:" f-16"},[a("div",{staticClass:"row q-pa-sm justify-center"},[a("div",{staticClass:"col-xs-12 col-md-8 "},[a("div",{staticClass:"row justify-between q-mb-xl"},[a("div",{staticClass:" text-h6 text-weight-bold "},[e._v("\n          Найти клиента\n        ")]),a("div",[a("q-btn",{attrs:{flat:"",icon:"logout",label:"Выйти"},on:{click:e.logOut}})],1)]),a("q-form",{on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.searchAction.apply(null,arguments)}}},[a("div",{staticClass:"bg-white br-10 q-px-md q-pb-md"},[a("div",{staticClass:"row q-col-gutter-x-lg q-col-gutter-y-lg justify-between "},[a("div",{staticClass:"col"},[a("q-input",{ref:"phoneInput",attrs:{disable:e.loading&&!e.customerHold,rules:[e.rulesPhone],readonly:e.customerHold,"lazy-rules":"","no-error-icon":"",label:"Номер телефона",placeholder:"(___) ___-__-__",prefix:"+7",mask:"(###) ###-##-##"},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1),a("div",{staticClass:"col-12 col-sm-auto  row items-center "},[a("q-btn",{class:{"full-width":e.$q.screen.lt.sm},staticStyle:{"margin-bottom":"20px",height:"44px"},attrs:{loading:e.loading&&!e.customerHold,label:e.customerHold?"Проверить другого пользователя":"Проверить пользователя",type:"submit",color:"primary",icon:"person_search",rounded:"","no-caps":""},scopedSlots:e._u([{key:"loading",fn:function(){return[a("q-spinner-facebook")]},proxy:!0}])})],1)])])]),a("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[e.customerHold&&!e.customerNotFound?a("div",{staticClass:" q-mt-lg  "},[a("q-form",{staticClass:"q-col-gutter-md row",on:{submit:e.savePoliceDialog}},[a("div",{staticClass:"col-12 text-h6 text-weight-bold "},[e._v("\n              Данные полиса ОСАГО\n            ")]),a("transition",{attrs:{appear:"",name:"slide-left-fade"}},[a("div",{staticClass:"col-12 col-sm-6"},[a("div",{staticClass:"bg-white  litle-shadow br-10 overflow-hidden q-pb-md "},[a("div",{staticClass:"text-weight-bold"}),a("div",{staticClass:"q-px-md"},[a("q-input",{attrs:{label:"Дата начала действия полиса",mask:"##.##.####",rules:[function(t){return e.lengthRule(t,10)},function(e){return!!e||"Необходимо указать дату начала действия полиса"}],"no-error-icon":""},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{mask:"DD.MM.YYYY",minimal:""},model:{value:e.policieBlocks.startDate,callback:function(t){e.$set(e.policieBlocks,"startDate",t)},expression:"policieBlocks.startDate"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{"no-caps":"",label:"Ок",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}],null,!1,2631307226),model:{value:e.policieBlocks.startDate,callback:function(t){e.$set(e.policieBlocks,"startDate",t)},expression:"policieBlocks.startDate"}})],1)])])]),a("div",{staticClass:"col-12 col-sm-6"},[a("div",{staticClass:"bg-white  litle-shadow br-10 overflow-hidden q-pb-md q-px-md "},[a("q-select",{staticClass:"q-pb-lg",attrs:{options:[3,4,5,6,7,8,9,10,11,12],label:"Период действия (в мес.)"},model:{value:e.policieBlocks.month_count,callback:function(t){e.$set(e.policieBlocks,"month_count",t)},expression:"policieBlocks.month_count"}})],1)]),a("transition",{attrs:{appear:"",name:"slide-left-fade"}},[a("div",{staticClass:"col-12 col-sm-6"},[a("insurant",{attrs:{insurantData:e.policieBlocks.insurant}})],1)]),a("transition",{attrs:{appear:"",name:"slide-right-fade"}},[a("div",{staticClass:"col-12 col-sm-6"},[a("owner",{attrs:{ownerData:e.policieBlocks.owner,ownerIsInsurant:e.ownerIsInsurant},on:{changeStatus:function(t){e.ownerIsInsurant=t}}})],1)]),a("transition",{attrs:{appear:"",name:"slide-left-fade"}},[a("div",{staticClass:"col-12 col-sm-6"},[a("car",{attrs:{carData:e.policieBlocks.car}})],1)]),a("transition",{attrs:{appear:"",name:"slide-right-fade"}},[a("div",{staticClass:"col-12 col-sm-6"},[a("docs",{attrs:{docsData:e.policieBlocks.docs,diagnosticData:e.policieBlocks.diagnostic}})],1)]),a("div",{staticClass:"col-12 "},[a("drivers",{attrs:{drivers:e.policieBlocks.drivers,unlimited:e.policieBlocks.unlimited},on:{setUnlimited:function(t){e.policieBlocks.unlimited=t}}})],1),a("transition",{attrs:{appear:"",name:"slide-down-fade"}},[a("div",{staticClass:"col-12",staticStyle:{position:"sticky",bottom:"0px"}},[a("div",{class:{"shadow-up-4":!e.isIntersect},staticStyle:{"border-top-left-radius":"10px","border-top-right-radius":"10px"}},[a("div",{staticClass:"row bg-white litle-shadow br-10  q-px-sm  q-py-md justify-center"},[a("div",{staticClass:"col-xs-10 col-sm-8 col-md-6"},[a("q-btn",{staticClass:"full-width",staticStyle:{height:"44px"},attrs:{color:"primary",icon:"save",label:"Сохранить",type:"submit",rounded:""}})],1)])])])]),a("div",{directives:[{name:"intersection",rawName:"v-intersection",value:e.onIntersection,expression:"onIntersection"}]})],1)],1):e.customerNotFound?a("div",{staticClass:"flex flex-center q-pa-lg"},[a("q-btn",{attrs:{color:"primary",icon:"person_add",label:"Добавить текущего пользователя"},on:{click:e.addClient}})],1):e._e()])],1)])])},o=[],i=a("e4fd"),l=a("79f6"),n=a("436b"),c=a("f508"),r=a("18d6"),d=a("51aa"),u=a("a20a"),p=function(e,t,a,s){function o(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,i){function l(e){try{c(s.next(e))}catch(t){i(t)}}function n(e){try{c(s["throw"](e))}catch(t){i(t)}}function c(e){e.done?a(e.value):o(e.value).then(l,n)}c((s=s.apply(e,t||[])).next())}))};const v=()=>{const e=Object(i["ref"])(!1),t=({phone:t})=>p(void 0,void 0,void 0,(function*(){return e.value=!0,yield Object(l["j"])(t).then((t=>{if(e.value=!1,t)return t}))})),a=()=>p(void 0,void 0,void 0,(function*(){return yield Object(l["a"])().then((()=>!0))})),s=({police:e,ownerIsInsurant:t})=>p(void 0,void 0,void 0,(function*(){return yield Object(l["i"])({police:e,ownerIsInsurant:t}).then((e=>e))}));return{loading:e,searchCustomer:t,addCustomer:a,savePolice:s}},m=()=>{const e=Object(i["ref"])(""),t=Object(i["ref"])({resetValidation:()=>{}}),a=e=>e?15===e.length||"Номер телефона введен не полностью":"Для проверки клиента необходимо указать его номер телефона",s=Object(i["ref"])({}),o=Object(i["ref"])(!1),l=Object(i["ref"])(!1),r=Object(i["ref"])(!1),{searchCustomer:d,addCustomer:u,savePolice:m,loading:b}=v(),f=()=>p(void 0,void 0,void 0,(function*(){o.value?n["a"].create({title:"Вы уверены?",message:"Все несохранненные данные будут утеряны",ok:{"no-caps":!0,label:"Да"},cancel:{"no-caps":!0,flat:!0,label:"Нет"}}).onOk((()=>{o.value=!1,l.value=!1})):yield d({phone:e.value}).then((e=>{e&&(s.value=null===e||void 0===e?void 0:e.fields,o.value=(null===e||void 0===e?void 0:e.status)||!1,(null===e||void 0===e?void 0:e.status)||(l.value=!0,w()))}))})),h=e=>e.replace(/\-+|\(+|\)+|\s+/g,""),g=()=>p(void 0,void 0,void 0,(function*(){var t;c["a"].show();const a=null===(t=s.value)||void 0===t?void 0:t.insurant;a.phone_number.value=h(e.value),yield u(),l.value=!1,o.value=!0,c["a"].hide()})),w=()=>{n["a"].create({title:"Пользователь не найден.",message:"Добавить нового пользователя ?",ok:{"no-caps":!0,label:"Да"},cancel:{"no-caps":!0,flat:!0,label:"Нет"}}).onOk((()=>{g()}))},k=()=>{var e,t;let a=null===(e=s.value)||void 0===e?void 0:e.drivers;a.length||(null===(t=s.value)||void 0===t?void 0:t.unlimited)?n["a"].create({title:"Сохранить документ?",ok:{label:"Да","no-caps":!0},cancel:{label:"Нет",flat:!0,"no-caps":!0}}).onOk((()=>p(void 0,void 0,void 0,(function*(){c["a"].show(),yield m({police:s.value,ownerIsInsurant:r.value}).then((e=>{e&&(C(),o.value=!1,l.value=!1)})),c["a"].hide()})))):y({title:"Не указан ни 1 водитель",message:'Укажите хотябы 1 водителя или установите флаг "Неограниченное кол-во"'})},C=()=>{e.value="",t.value.resetValidation(),n["a"].create({title:"Данные успешно сохранены"})},y=({title:e,message:t})=>{n["a"].create({title:e,message:t})};return{phone:e,rulesPhone:a,customerHold:o,customerNotFound:l,policieBlocks:s,searchAction:f,addClient:g,savePoliceDialog:k,loading:b,ownerIsInsurant:r,phoneInput:t}},b=()=>{const e=Object(i["ref"])(!1),t=t=>{e.value=t.isIntersecting};return{onIntersection:t,isIntersect:e}},f=()=>{const e=()=>{n["a"].create({title:"Вы уверены что хотите выйти?",message:"Все не сохраненные данные будут утеряны",confirm:confirm,ok:{noCpas:!0,label:"Да"},cancel:{noCaps:!0,flat:!0,label:"Нет"}}).onOk((()=>{r["a"].remove("access_token"),null===d["b"]||void 0===d["b"]||d["b"].replace("/policies/auth")}))};return{logOut:e}};var h=Object(i["defineComponent"])({name:"AddOsagoPage",components:{insurant:()=>Promise.all([a.e(0),a.e(30)]).then(a.bind(null,"d074")),owner:()=>Promise.all([a.e(0),a.e(31)]).then(a.bind(null,"a885")),car:()=>Promise.all([a.e(0),a.e(26)]).then(a.bind(null,"848f")),docs:()=>Promise.all([a.e(0),a.e(27)]).then(a.bind(null,"53d8")),drivers:()=>Promise.all([a.e(0),a.e(28)]).then(a.bind(null,"65b3"))},setup(){const{lengthRule:e}=Object(u["b"])();return Object.assign(Object.assign(Object.assign(Object.assign({},m()),b()),f()),{lengthRule:e})}}),g=h,w=a("2877"),k=a("9989"),C=a("9c40"),y=a("0378"),x=a("27f9"),q=a("e669"),I=a("0016"),O=a("7cbe"),j=a("52ee"),_=a("ddd8"),B=a("7f67"),P=a("9748"),D=a("eebe"),Q=a.n(D),S=Object(w["a"])(g,s,o,!1,null,null,null);t["default"]=S.exports;Q()(S,"components",{QPage:k["a"],QBtn:C["a"],QForm:y["a"],QInput:x["a"],QSpinnerFacebook:q["a"],QIcon:I["a"],QPopupProxy:O["a"],QDate:j["a"],QSelect:_["a"]}),Q()(S,"directives",{ClosePopup:B["a"],Intersection:P["a"]})}}]);